<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QFNU 抢课脚本配置生成器</title>
    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <!-- Element Plus JS -->
    <script src="https://unpkg.com/element-plus"></script>
    <!-- Element Plus Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    <style>
        :root {
            --cookie-primary: #7D491E;
            --cookie-light: #9E6A3A;
            --cookie-lighter: #C4956A;
            --cookie-cream: #E8D5C4;
            --cookie-milk: #F5EDE5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(180deg, var(--cookie-milk) 0%, #fff 100%);
            min-height: 100vh;
        }

        #app {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--cookie-primary) 0%, var(--cookie-light) 100%);
            border-radius: 16px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(125, 73, 30, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            color: rgba(255, 255, 255, 0.85);
            font-size: 14px;
        }

        .main-card {
            border-radius: 16px;
            border: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .main-card .el-card__header {
            background: var(--cookie-milk);
            border-bottom: 1px solid var(--cookie-cream);
            padding: 16px 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--cookie-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .course-card {
            border: 1px solid var(--cookie-cream);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .course-card .el-card__header {
            background: linear-gradient(180deg, var(--cookie-cream) 0%, var(--cookie-milk) 100%);
            padding: 12px 16px;
            border-bottom: 1px solid var(--cookie-cream);
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .course-number {
            font-weight: 600;
            color: var(--cookie-primary);
        }

        .add-btn {
            width: 100%;
            height: 50px;
            border: 2px dashed var(--cookie-cream);
            border-radius: 12px;
            color: var(--cookie-primary);
            font-size: 15px;
            margin-bottom: 20px;
        }

        .add-btn:hover {
            border-color: var(--cookie-primary);
            background: var(--cookie-milk);
        }

        .action-btns {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .generate-btn {
            background: linear-gradient(135deg, var(--cookie-primary) 0%, var(--cookie-light) 100%);
            border: none;
            height: 50px;
        }

        .generate-btn:hover {
            background: linear-gradient(135deg, var(--cookie-light) 0%, var(--cookie-primary) 100%);
        }

        .output-card {
            border-radius: 12px;
            overflow: hidden;
        }

        .output-card .el-card__header {
            background: #2d2d2d !important;
            border-bottom: none !important;
            padding: 12px 16px !important;
        }

        .output-card .el-card__body {
            background: #1e1e1e !important;
            padding: 16px !important;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .output-title {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
        }

        .output-pre {
            color: #f5f5f5 !important;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            max-height: 300px;
            overflow-y: auto;
            background: transparent !important;
        }

        /* Element Plus Custom Theme */
        :root {
            --el-color-primary: #7D491E;
            --el-color-primary-light-3: #9E6A3A;
            --el-color-primary-light-5: #B8885A;
            --el-color-primary-light-7: #D2A67A;
            --el-color-primary-light-9: #F5EDE5;
            --el-color-primary-dark-2: #5C3615;
        }

        .el-button--primary {
            --el-button-bg-color: var(--cookie-primary);
            --el-button-border-color: var(--cookie-primary);
            --el-button-hover-bg-color: var(--cookie-light);
            --el-button-hover-border-color: var(--cookie-light);
        }

        .el-radio-button__inner:hover {
            color: var(--cookie-primary);
        }

        .el-radio-button__original-radio:checked + .el-radio-button__inner {
            background-color: var(--cookie-primary);
            border-color: var(--cookie-primary);
        }

        .el-input__wrapper:focus-within {
            box-shadow: 0 0 0 1px var(--cookie-primary) inset;
        }

        .el-select .el-input.is-focus .el-input__wrapper {
            box-shadow: 0 0 0 1px var(--cookie-primary) inset !important;
        }

        /* 修复el-select下拉框样式 */
        .full-width-select {
            width: 100% !important;
            display: block !important;
        }

        .full-width-select .el-select__wrapper {
            width: 100% !important;
        }

        /* 确保下拉菜单垂直显示 */
        .el-select-dropdown__list {
            display: flex !important;
            flex-direction: column !important;
        }

        .el-select-dropdown__item {
            display: block !important;
            width: 100% !important;
        }

        /* 修复el-input-number宽度 */
        .el-input-number {
            width: 100% !important;
        }

        .el-input-number .el-input__wrapper {
            width: 100%;
        }

        @media (max-width: 768px) {
            #app {
                padding: 12px;
            }

            .header {
                padding: 30px 16px;
                border-radius: 12px;
            }

            .header h1 {
                font-size: 22px;
            }

            .action-btns {
                grid-template-columns: 1fr;
            }
        }

        .tips-alert {
            margin-bottom: 20px;
            border-radius: 12px;
        }

        .copy-btn {
            color: white !important;
            border-color: rgba(255, 255, 255, 0.3) !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <div class="header">
            <h1>QFNU 配置生成器</h1>
            <p>曲阜师范大学抢课脚本配置工具</p>
        </div>

        <!-- 提示信息 -->
        <el-alert
            class="tips-alert"
            title="使用提示"
            type="warning"
            description="支持两种模式：直接填写课程ID（推荐）或通过上课时间搜索"
            :closable="false"
            show-icon
        />

        <!-- 基础配置 -->
        <el-card class="main-card">
            <template #header>
                <span class="card-title">
                    <el-icon><User /></el-icon>
                    账号信息
                </span>
            </template>
            <el-form label-position="top">
                <el-row :gutter="20">
                    <el-col :xs="24" :sm="12">
                        <el-form-item label="学号" required>
                            <el-input v-model="config.user_account" placeholder="请输入学号" />
                        </el-form-item>
                    </el-col>
                    <el-col :xs="24" :sm="12">
                        <el-form-item label="密码" required>
                            <el-input v-model="config.user_password" type="password" placeholder="教务系统密码" show-password />
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-form-item label="飞书通知（可选）">
                    <el-input v-model="config.feishu_webhook" placeholder="Webhook 地址，留空则不通知" />
                </el-form-item>
            </el-form>
        </el-card>

        <!-- 课程配置 -->
        <el-card class="main-card">
            <template #header>
                <span class="card-title">
                    <el-icon><Collection /></el-icon>
                    课程列表
                </span>
            </template>

            <!-- 课程卡片列表 -->
            <el-card v-for="(course, index) in config.courses" :key="index" class="course-card" shadow="never">
                <template #header>
                    <div class="course-header">
                        <span class="course-number">课程 {{ index + 1 }}</span>
                        <el-button type="danger" text @click="removeCourse(index)">
                            <el-icon><Delete /></el-icon> 删除
                        </el-button>
                    </div>
                </template>

                <el-form label-position="top">
                    <!-- 基础信息 -->
                    <el-row :gutter="16">
                        <el-col :xs="24" :sm="8">
                            <el-form-item label="课程名称" required>
                                <el-input v-model="course.course_name" placeholder="如：高等数学" />
                            </el-form-item>
                        </el-col>
                        <el-col :xs="24" :sm="8">
                            <el-form-item label="课程编号" required>
                                <el-input v-model="course.course_id" placeholder="如：g20062389" />
                            </el-form-item>
                        </el-col>
                        <el-col :xs="24" :sm="8">
                            <el-form-item label="教师姓名" required>
                                <el-input v-model="course.teacher_name" placeholder="如：张三" />
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <!-- 模式切换 -->
                    <el-form-item label="选课模式">
                        <el-radio-group v-model="course.mode" size="default">
                            <el-radio-button :value="1">直接 ID 模式</el-radio-button>
                            <el-radio-button :value="2">搜索模式</el-radio-button>
                        </el-radio-group>
                    </el-form-item>

                    <!-- 模式一：直接ID -->
                    <template v-if="course.mode === 1">
                        <el-row :gutter="16">
                            <el-col :xs="24" :sm="12">
                                <el-form-item label="jx02id" required>
                                    <el-input v-model="course.jx02id" placeholder="课程 jx02id" />
                                </el-form-item>
                            </el-col>
                            <el-col :xs="24" :sm="12">
                                <el-form-item label="jx0404id" required>
                                    <el-input v-model="course.jx0404id" placeholder="课程 jx0404id" />
                                </el-form-item>
                            </el-col>
                        </el-row>
                        <el-text type="info" size="small">通过高年级账号或抓包获取课程 ID</el-text>
                    </template>

                    <!-- 模式二：搜索模式 -->
                    <template v-else>
                        <el-divider content-position="left">搜索条件</el-divider>
                        <el-row :gutter="16">
                            <el-col :xs="24" :sm="12">
                                <el-form-item label="星期" required>
                                    <el-select v-model="course.skxq" placeholder="请选择" class="full-width-select">
                                        <el-option v-for="i in 7" :key="i" :label="'星期' + ['一','二','三','四','五','六','日'][i-1]" :value="String(i)"></el-option>
                                    </el-select>
                                </el-form-item>
                            </el-col>
                            <el-col :xs="24" :sm="12">
                                <el-form-item label="节次范围" required>
                                    <el-select v-model="course.skjc" placeholder="请选择" class="full-width-select">
                                        <el-option label="1-2 节" value="1-2"></el-option>
                                        <el-option label="3-4 节" value="3-4"></el-option>
                                        <el-option label="5-6 节" value="5-6"></el-option>
                                        <el-option label="7-8 节" value="7-8"></el-option>
                                        <el-option label="9-11 节" value="9-11"></el-option>
                                        <el-option label="12-13 节" value="12-13"></el-option>
                                    </el-select>
                                </el-form-item>
                            </el-col>
                        </el-row>

                        <el-divider content-position="left">第一节课信息</el-divider>
                        <el-row :gutter="16">
                            <el-col :xs="24" :sm="8">
                                <el-form-item label="周次" required>
                                    <el-input-number v-model="course.first_week" :min="1" :max="20" placeholder="第几周" />
                                </el-form-item>
                            </el-col>
                            <el-col :xs="24" :sm="8">
                                <el-form-item label="星期" required>
                                    <el-select v-model="course.first_xq" placeholder="请选择" class="full-width-select">
                                        <el-option v-for="i in 7" :key="i" :label="'星期' + ['一','二','三','四','五','六','日'][i-1]" :value="String(i)"></el-option>
                                    </el-select>
                                </el-form-item>
                            </el-col>
                            <el-col :xs="24" :sm="8">
                                <el-form-item label="节次" required>
                                    <el-select v-model="course.first_jc" placeholder="请选择" class="full-width-select">
                                        <el-option v-for="i in 13" :key="i" :label="'第 ' + i + ' 节'" :value="String(i).padStart(2, '0')"></el-option>
                                    </el-select>
                                </el-form-item>
                            </el-col>
                        </el-row>
                        <el-text type="info" size="small">填写该课程第一节课的具体时间用于精确匹配</el-text>
                    </template>
                </el-form>
            </el-card>

            <!-- 添加课程按钮 -->
            <el-button class="add-btn" @click="addCourse">
                <el-icon><Plus /></el-icon> 添加课程
            </el-button>
        </el-card>

        <!-- 操作按钮 -->
        <div class="action-btns">
            <el-button type="primary" class="generate-btn" size="large" @click="generateConfig">
                <el-icon><Lightning /></el-icon> 生成配置
            </el-button>
            <el-button type="success" size="large" @click="downloadConfig">
                <el-icon><Download /></el-icon> 下载文件
            </el-button>
            <el-button size="large" @click="clearAll">
                <el-icon><Delete /></el-icon> 清空全部
            </el-button>
        </div>

        <!-- 输出区域 -->
        <el-card class="output-card" shadow="always">
            <template #header>
                <div class="output-header">
                    <span class="output-title">config.json</span>
                    <el-button class="copy-btn" size="small" @click="copyConfig">
                        <el-icon><CopyDocument /></el-icon> 复制
                    </el-button>
                </div>
            </template>
            <pre class="output-pre">{{ outputJson }}</pre>
        </el-card>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        const app = createApp({
            setup() {
                const config = ref({
                    user_account: '',
                    user_password: '',
                    feishu_webhook: '',
                    courses: []
                });

                const outputJson = ref('// 点击「生成配置」预览结果');

                const createEmptyCourse = () => ({
                    course_name: '',
                    course_id: '',
                    teacher_name: '',
                    mode: 1,
                    jx02id: '',
                    jx0404id: '',
                    skxq: '',
                    skjc: '',
                    first_week: null,
                    first_xq: '',
                    first_jc: ''
                });

                const addCourse = () => {
                    config.value.courses.push(createEmptyCourse());
                };

                const removeCourse = (index) => {
                    config.value.courses.splice(index, 1);
                };

                const generateConfig = () => {
                    const output = {
                        user_account: config.value.user_account,
                        user_password: config.value.user_password,
                        feishu_webhook: config.value.feishu_webhook,
                        courses: config.value.courses.map(course => {
                            const base = {
                                course_name: course.course_name,
                                course_id: course.course_id,
                                teacher_name: course.teacher_name,
                                jx02id: '',
                                jx0404id: '',
                                skxq: '',
                                skjc: '',
                                first_week: '',
                                first_xq: '',
                                first_jc: ''
                            };

                            if (course.mode === 1) {
                                base.jx02id = course.jx02id;
                                base.jx0404id = course.jx0404id;
                            } else {
                                base.skxq = course.skxq;
                                base.skjc = course.skjc;
                                base.first_week = course.first_week ? String(course.first_week) : '';
                                base.first_xq = course.first_xq;
                                base.first_jc = course.first_jc;
                            }

                            return base;
                        })
                    };

                    outputJson.value = JSON.stringify(output, null, 2);
                    ElementPlus.ElMessage.success('配置已生成');
                    return output;
                };

                const downloadConfig = () => {
                    const output = generateConfig();
                    const blob = new Blob([JSON.stringify(output, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'config.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    ElementPlus.ElMessage.success('文件下载成功');
                };

                const copyConfig = () => {
                    navigator.clipboard.writeText(outputJson.value).then(() => {
                        ElementPlus.ElMessage.success('已复制到剪贴板');
                    });
                };

                const clearAll = () => {
                    ElementPlus.ElMessageBox.confirm('确定要清空所有配置吗？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        config.value = {
                            user_account: '',
                            user_password: '',
                            feishu_webhook: '',
                            courses: [createEmptyCourse()]
                        };
                        outputJson.value = '// 点击「生成配置」预览结果';
                        ElementPlus.ElMessage.success('已清空');
                    }).catch(() => {});
                };

                // 初始化添加一个课程
                addCourse();

                return {
                    config,
                    outputJson,
                    addCourse,
                    removeCourse,
                    generateConfig,
                    downloadConfig,
                    copyConfig,
                    clearAll
                };
            }
        });

        // 注册 Element Plus 图标
        for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
            app.component(key, component);
        }

        app.use(ElementPlus);
        app.mount('#app');
    </script>
</body>
</html>
